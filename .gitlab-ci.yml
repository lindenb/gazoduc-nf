image: eclipse-temurin:17-jdk

before_script:
  - env | grep -i PROXY
  - apt-get update -y
  - apt-get install -y make wget curl samtools bcftools tabix bedtools python3 bzip2 unzip zip
  - (mkdir -p bin && cd bin && curl -s https://get.nextflow.io | bash && chmod +x nextflow)
  - export PATH="${PWD}/bin:${PATH}"
  - nextflow info
  - curl -Ls https://micro.mamba.pm/api/micromamba/linux-64/latest | tar -xvj bin/micromamba
  - export PATH="${PWD}/bin:${PATH}"
  - eval "$(./bin/micromamba shell hook -s posix)"
  - export NXF_ANSI_LOG=false

stages:
  - test

wgsim:
  stage: test
  script:
    - make -C tests test_wgsim

fastqc:
  stage: test
  needs: ["wgsim"]
  script:
    - make -C tests test_fastqc

bwa:
  stage: test
  needs: ["wgsim"]
  script:
    - make -C tests test_bwa


hapcaller:
  stage: test
  needs: ["bwa"]
  script:
    - make -C tests test_hapcaller


