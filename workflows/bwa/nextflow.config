
params {
	outdir="results"
	fasta = null
	ucsc_name = "undefined"
}
includeConfig "../../config/nextflow.config"

params {
	samplesheet = null
	bwa_index_directory = null
	capture=null
	bed=null //limit BAM to this bed (not a capture)
	known_sites  = null //vcf for recalibration
	with_bqsr = true
	with_cram = true
	with_markdup = true
	with_seqkit_split = true
  bam2fastq_method = "samtools" // samtools|parabricks|gatk
	markdup_method = "markduplicates"
}

process {
  withName : "PREPARE_ONE_REFERENCE:PREPARE_REFERENCE:SCATTER_TO_BED:SCATTER_INTERVALS_BY_NS" {
    ext.output_type = "ACGT"
    ext.max_to_merge = 1
  }

withName: "MAP_BWA:BQSR:BED_CLUSTER" {
   ext.args = "--size 50Mb"
}

withName : "MAP_BWA:BAM_TO_CRAM" {
	publishDir = [
          path:{"${params.outdir}/BAMS/${meta.id}"},
          saveAs: { filename -> "${params.prefix?:""}$filename" },
          pattern : '*.{bam,cram,bai,crai,md5}',
          mode: "copy",
          overwrite : true
          ]
	}

withName : "MAKE_SAMPLESHEET" {
	publishDir = [
          path:{"${params.outdir}/BAMS"},
          saveAs: { filename -> "${params.prefix?:""}$filename" },
          pattern : '*.{csv}',
          mode: "copy",
          overwrite : true
          ]
	}
	
	
withName: "MULTIQC:MQC1" {
       publishDir = [
                path:"${params.outdir}/multiqc/all",
				saveAs: { filename -> "${params.prefix}${filename}" },
                mode: "copy",
                pattern : '*.{zip,html}',
                overwrite : true
                ]
	}

withName: "MULTIQC:MQC2" {
       publishDir = [
                path:"${params.outdir}/multiqc/per_pop",
				saveAs: { filename -> "${params.prefix}${filename}" },
                mode: "copy",
                pattern : '*.{zip,html}',
                overwrite : true
                ]
	}	

withName : "BAM_QC:SAMTOOLS_FLAGSTATS" {
	ext.args1 = ""
	}

}
