params {
	help = false
	outdir = "results"
	prefix = ""
	fasta = null
	ucsc_name = "undefined"
	
}
includeConfig "../../config/nextflow.config"


params {
	samplesheet =null
	bed = null
	//downsampling depths. integer , comma separated
	depths = "1,2,5,10,15,20"
	// will force the original BAM to be filtered as the downsampled one
	use_original_bam = true
	filter=" -q 30 -M -F 3844 "
	}




process {

withName: "PREPARE_USER_BED:CHECK_BED" {
	maxRetries = 1
	ext.with_merge = true
	}


withName: "PREPARE_REFERENCE:SCATTER_TO_BED:SCATTER_INTERVALS_BY_NS" {
          ext.output_type = "ACGT"
          ext.max_to_merge = 1
        }

withName: "GHOSTSCRIPT_MERGE" {
	publishDir = [
			path:"${params.outdir}",
            saveAs: { filename -> "${params.prefix}${filename}" },
			mode: "copy",
			pattern : '*.{pdf}',
			overwrite : true
			]
	}

withName: "MOSDEPTH1|MOSDEPTH2" {
	publishDir = [
			path:{"${params.outdir}/BAMS/${meta.id}"},
            saveAs: { filename -> "${params.prefix}${filename}" },
			mode: "copy",
			pattern : '*.{txt,gz,csi}',
			overwrite : true
			]
	}

withName: "MULTIQC:MQC1" {
	publishDir = [
			path:"${params.outdir}/multiqc/all",
            saveAs: { filename -> "${params.prefix}${filename}" },
			mode: "copy",
			pattern : '*.{zip,html}',
			overwrite : true
			]
	}

withName: "DOWNSAMPLE" {
	publishDir = [
			path: {"${params.outdir}/BAMS/${meta.id}"},
           saveAs: { filename -> "${params.prefix}${filename}" },
			mode: "copy",
			pattern : '*.{bam,bai,cram,crai,md5}',
			overwrite : true
			]
	}

withName: "GENOTYPEGVCFS" {
        publishDir = [
                        path: {"${params.outdir}/BAMS/${meta.id}"},
           saveAs: { filename -> "${params.prefix}${filename}" },
                        mode: "copy",
                        pattern : '*.{vcf.gz,tbi,bcf,csi,md5}',
                        overwrite : true
                        ]
        }


withName : "SAMTOOLS_VIEW" {
	ext.args1 = {params.filter}
	}
withName : "DOWNSAMPLE" {
	ext.args1 = {params.filter}
	}
}

