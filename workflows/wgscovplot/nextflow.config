

params {
    fasta = null
    help = false
    outdir = "results"
    prefix = ""
	/* csv file with header: sample,bam(,fasta,fai,dict) */
	samplesheet= null
    radius = 1000
	}

includeConfig "../../config/nextflow.config"

process {
    

withName: "PREPARE_ONE_REFERENCE:PREPARE_REFERENCE:SCATTER_TO_BED:SCATTER_INTERVALS_BY_NS" {
	ext.output_type = "ACGT"
        ext.max_to_merge = 1
	}

withName: "PLOT_WGS_COVERAGE:FAI_TO_SVG:BED_TO_XML" {
    ext.args1 = "--min-contig-length 50000000"
    ext.with_dict  = true
    }

withName:"PLOT_WGS_COVERAGE:DICT_TO_BED" {
    ext.args1 = "--no-header" 
    }

withName : "PLOT_WGS_COVERAGE:BEDTOOLS_MAKEWINDOWS" {
    ext.args = {"-w ${(meta.genome_length/500) as long}"}
    }
withName : "MOSDEPTH" {
    ext.arsgs="--use-median"
    }

withName : "PLOT_WGS_COVERAGE:CYTOBAND_TO_SVG:BED_TO_XML" {
    ext.args1 = {" --columns name,color"}
    }

withName : "PLOT_WGS_COVERAGE:BED_TO_XML" {
    ext.args1 = {" --columns title,norm,class"}
    }


withName : "PLOT_WGS_COVERAGE:CYTOBAND_TO_SVG:XSLTPROC" {
    ext.args1 = {"--stringparam radius_R1 ${params.radius} -stringparam radius_R2 ${(params.radius as int)-50}  "}
    }
withName : "PLOT_WGS_COVERAGE:XSLTPROC" {
    ext.args1 = {"--stringparam class donut_${meta.index_mod2}  --stringparam title \"${meta.id}\" --stringparam radius_R1 ${meta.outer_radius} -stringparam radius_R2 ${meta.inner_radius}  "}
    }
withName : "BUILD_SVG" {
    ext.radius = {"${params.radius}"}
    }
withName : "BATIK_RASTERIZE_PDF|BATIK_RASTERIZE_PNG|BATIK_RASTERIZE_JPG" {
    publishDir = [
        path: {"${params.outdir}"},
        saveAs: { filename -> "${params.prefix}$filename" },
        mode: "copy",
        pattern : '*.{png,pdf,png,jpg}',
        overwrite : true
        ]
    }
}