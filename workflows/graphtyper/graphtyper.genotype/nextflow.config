params {
	help=false
	prefix=""
	outdir=""

	/** samplesheet tsv with header sample/bam/bai */
	samplesheet = "NO_FILE"

	/* limit to that bed  not bedS because graphtyper split input by 50kb  */
	bed = "NO_FILE"
	/** .. but for a small number of samples, it's faster to pool bed together, so it's the size of the pool */
	bedcluster_size = "50kb"
	/** optional TSV file mapping sample to its DEPTH */
	sample2depth = "NO_FILE"
	/** mapq min MAPQ */
	mapq = 10
	/** how to calculate depth ? */
	depth_method = "mosdepth"
	/** cpus for mosdepth */
	mosdepth_cpus = 1

	/** parameters for bedtools makewin in MAKE_INTERVAL */
	makewin_args = " -w 50000 -s 49990"
	}


conda.enabled = true

process {

withName: "MOSDEPTH" {
	cpus =  ("${params.mosdepth_cpus}" as int)
	}


withName: "MAKE_INTERVALS" {
	ext.args1 = {params.makewin_args}
}

withName: "GRAPHTYPER" {
	array=100
}

withName : "MERGE" {
                publishDir = [
                path:"${params.outdir}/release",
                saveAs: { filename -> "${params.prefix}$filename" },
                mode: "move",
                pattern : '*.{bcf,csi,vcf.gz,tbi}',
                overwrite : true
                ]
        }

withName : "SAVE_FAILED" {
                publishDir = [
                path:"${params.outdir}/release",
                saveAs: { filename -> "${params.prefix}$filename" },
                mode: "copy",
                pattern : '*.{txt,tsv,bed}',
                overwrite : true
                ]
	}        

}

