nextflow_workflow {

    name "Test Workflow SAMPLESHEET_TO_FASTQ"
    script "subworkflows/samplesheet2fastq/main.nf"
    workflow "SAMPLESHEET_TO_FASTQ"
    tag "gitlab_ci"
    tag "subworkflows"
    tag "subworkflows/samplesheet2fastq"
    tag "fastq"
    tag "ora"

    test("ORA_NO_NAME") {
        options "-stub"
        when {
            params {
                // define parameters here. Example:
                // outdir = "tests/results"
            }
            workflow {
                """
               input[0] = [id:"meta",bam2fastq_method:"samtools"]
               input[1]= Channel.of(
               			[
               			fastq_1:"${projectDir}/tests/data/S1_S10_L008_R2_001.fastq.ora"
               			]
               		)
                """
            }
        }

        then {
            assert workflow.success
            //assert snapshot(workflow.out).match()
        }
    }

   test("ORA_SINGLE_NAME") {
        options "-stub"
        when {
            params {
                // define parameters here. Example:
                // outdir = "tests/results"
            }
            workflow {
                """
               input[0] = [id:"meta",bam2fastq_method:"samtools"]
               input[1]= Channel.of(
               			[
               			id:"S1",
               			fastq_1:"${projectDir}/tests/data/S1_S10_L008_R2_001.fastq.ora"
               			]
               		)
                """
            }
        }

        then {
            assert workflow.success
            //assert snapshot(workflow.out).match()
        }
    }



    test("PAIRED") {

        when {
            params {
                // define parameters here. Example:
                // outdir = "tests/results"
            }
            workflow {
                """
               input[0] = [id:"meta",bam2fastq_method:"samtools"]
               input[1]= Channel.of(
               			[
               			id:"S1",
               			fastq_1:"${projectDir}/tests/data/S1.R1.fq.gz",
               			fastq_2:"${projectDir}/tests/data/S1.R2.fq.gz"
               			],
               			[
               			id:"S2",
               			fastq_1:"${projectDir}/tests/data/S2.R1.fq.gz",
               			fastq_2:"${projectDir}/tests/data/S2.R2.fq.gz"
               			]
               		)
                """
            }
        }

        then {
            assert workflow.success
            //assert snapshot(workflow.out).match()
        }
    }


    test("PAIRED_NO_NAME") {
        options "-stub"
        // TODO fix when file exists
        when {
            params {
                // define parameters here. Example:
                // outdir = "tests/results"
            }
            workflow {
                """
               input[0] = [id:"meta",bam2fastq_method:"samtools"]
               input[1]= Channel.of(
               			[
               			fastq_1:"${projectDir}/tests/data/4-0122-T-F_S16_L003_R1_001.fastq.gz",
               			fastq_2:"${projectDir}/tests/data/4-0122-T-F_S16_L003_R2_001.fastq.gz"
               			]
               		)
                """
            }
        }

        then {
            assert workflow.success
            //assert snapshot(workflow.out).match()
        }
    }


	test("SINGLE") {

        when {
            params {
                // define parameters here. Example:
                // outdir = "tests/results"
            }
            workflow {
                """
               input[0] = [id:"meta",bam2fastq_method:"samtools"]
               input[1]= Channel.of(
               			[
               			id:"S1",
               			fastq_1:"${projectDir}/tests/data/S1.R1.fq.gz"
               			],
               			[
               			id:"S2",
               			fastq_1:"${projectDir}/tests/data/S2.R1.fq.gz",
               			fastq_2:""
               			]
               		)
                """
            }
        }

        then {
            assert workflow.success
            //assert snapshot(workflow.out).match()
        }
    }

     test("SINGLE_NO_NAME") {
        options "-stub"
        //TODO fix when file exists
        when {
            params {
                // define parameters here. Example:
                // outdir = "tests/results"
            }
            workflow {
                """
               input[0] = [id:"meta",bam2fastq_method:"samtools"]
               input[1]= Channel.of(
               			[
               			fastq_1:"${projectDir}/tests/data/4-0122-T-F_S16_L003_R1_001.fastq.gz"
               			]
               		)
                """
            }
        }

        then {
            assert workflow.success
            //assert snapshot(workflow.out).match()
        }
    }

	test("BAMS_NONAME") {
        when {
            params {
                // define parameters here. Example:
                // outdir = "tests/results"
            }
            workflow {
                """
               input[0] = [id:"meta",bam2fastq_method:"samtools"]
               input[1]= Channel.of(
               			[
               			bam:"${projectDir}/tests/data/S1.bam"
               			],
               			[
               			bam:"${projectDir}/tests/data/S2.bam"
               			]
               		)
                """
            }
        }

        then {
            assert workflow.success
            //assert snapshot(workflow.out).match()
        }
    }


    test("BAMS_SAMTOOLS") {

        when {
            params {
                // define parameters here. Example:
                // outdir = "tests/results"
            }
            workflow {
                """
               input[0] = [id:"meta",bam2fastq_method:"samtools"]
               input[1]= Channel.of(
               			[
               			id:"S1",
               			bam:"${projectDir}/tests/data/S1.bam"
               			],
               			[
               			id:"S2",
               			bam:"${projectDir}/tests/data/S2.bam"
               			]
               		)
                """
            }
        }

        then {
            assert workflow.success
            //assert snapshot(workflow.out).match()
        }
    }
    
    test("CRAMS") {

        when {
            params {
                // define parameters here. Example:
                // outdir = "tests/results"
            }
            workflow {
                """
               input[0] = [id:"meta",bam2fastq_method:"samtools"]
               input[1]= Channel.of(
               			[
               			id:"S1",
               			bam:"${projectDir}/tests/data/S1.cram",
               			fasta:"${projectDir}/tests/data/rotavirus_rf.fa"
               			]
               		)
                """
            }
        }

        then {
            assert workflow.success
            //assert snapshot(workflow.out).match()
        }
    }



}
